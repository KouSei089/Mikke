<div class="h-screen">
<div class="flex justify-center">
  <i class="far fa-calendar text-3xl mr-3 mb-1"></i>
  <h1 class="far text-3xl"><%= l Time.current, format: :long %></h1>
</div>

<%= render 'diaries/timer' %>

<div class="bg-white rounded px-8 pt-6 pb-8 mb-4">
  <%= form_with model: @diary, local: true do |f| %>
    <%# <%= render 'shared/error_messages', model: f.object %> %>

    <div class="mb-4">
      <%= f.label :text, class: "block text-gray-600 text-sm font-semibold mb-2", for: "text" %>
      <%= f.text_area :text, class: "bg-natural appearance-none border rounded-lg w-full h-64 py-2 px-3 text-dark-black leading-loose focus:outline-none focus:shadow-outline focus:border-blue-300", onkeyup: "ShowLength(value);" %>

      <p id="inputlength">0文字</p>

      <!--プログレスバー文字数-->
      <div class="relative pt-1">
        <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-pink-200">
          <% if @diary.present? %>
            <div id="stylewidth" style="width:<%= @diary.creativity.to_i / 10 %>%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-pink-500"></div>
          <% end %>
        </div>
      </div>
    </div>

    <div x-data="{isShow: false}">
        <h1 x-show="isShow">
        <div class="mb-4">
      <%= f.label :title, class: "block text-gray-600 text-sm font-semibold mb-2", for: "text" %>
      <%= f.text_field :title, class: "bg-natural appearance-none border rounded-lg w-full py-2 px-3 text-dark-black leading-loose focus:outline-none focus:shadow-outline focus:border-blue-300" %>
    </div>
        </h1>
        <button type="button" @click="isShow = !isShow" class="text-natural bg-dark-black hover:bg-natural hover:text-dark-black py-2 px-4 rounded focus:outline-none focus:shadow-outline">タイトル</button>
    </div>

    <div class="flex items-center justify-between">
      <%= f.submit nil, class: "text-natural bg-dark-black hover:bg-natural hover:text-dark-black py-2 px-4 rounded focus:outline-none focus:shadow-outline" %>
    </div>
  <% end %>
</div>
</div>

<script>
var timer1; //タイマーを格納する変数（タイマーID）の宣言

//カウントダウン関数を1000ミリ秒毎に呼び出す関数
function cntStart(){
  document.timer.elements[2].disabled=true;
  timer1=setInterval("countDown()",1000);
}

//タイマー停止関数
function cntStop(){
  document.timer.elements[2].disabled=false;
  clearInterval(timer1);
}

//カウントダウン関数
function countDown(){
  var min=document.timer.elements[0].value;
  var sec=document.timer.elements[1].value;

  if( (min=="") && (sec=="") ){
    alert("時刻を設定してください！");
    reSet();
  }
  else {
    if (min=="") min=0;
    min=parseInt(min);

    if (sec=="") sec=0;
    sec=parseInt(sec);

    tmWrite(min*60+sec-1);
  }
}

//残り時間を書き出す関数
function tmWrite(int){
  int=parseInt(int);

  if (int<=0){
    reSet();
    alert("時間です！");
  }
  else {
    //残り分数はintを60で割って切り捨てる
    document.timer.elements[0].value=Math.floor(int/60);
    //残り秒数はintを60で割った余り
    document.timer.elements[1].value=int % 60;
  }
}

//フォームを初期状態に戻す（リセット）関数
function reSet(){
  document.timer.elements[0].value="0";
  document.timer.elements[1].value="0";
  document.timer.elements[2].disabled=false;
  clearInterval(timer1);
}

//本文の文字数をカウントする関数
function ShowLength(str) {
   document.getElementById("inputlength").innerHTML = str.length + "文字";
   document.getElementById("stylewidth").style.width = str.length / 10 + "%";
}
</script>
